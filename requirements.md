# 小红书转抖音自动发布工具 - 需求文档 (PRD)

## 1. 项目简介
本项目旨在开发一款桌面端软件，帮助内容创作者高效地将小红书的图文/视频内容迁移并发布至抖音平台。软件基于 Tauri + Vue 技术栈，结合自动化脚本技术，实现“输入链接 -> 内容抓取 -> 自动填充发布”的一站式流程。

## 2. 核心流程
1. **输入**：用户在软件界面输入小红书笔记的分享链接。
2. **解析**：软件自动解析链接，提取笔记的标题、正文文案、图片或视频资源。
3. **确认**：用户在界面上预览抓取到的内容，可进行简单的编辑（如修改标题、删减图片）。
4. **发布**：用户点击“发布到抖音”，软件自动打开抖音创作者中心（或通过自动化浏览器），上传资源并填充标题和文案。
5. **完成**：发布成功后反馈结果。

## 3. 功能需求

### 3.1 小红书内容抓取
- **链接解析**：支持识别小红书 App 分享出来的短链接及网页长链接。
- **内容提取**：
  - **图文笔记**：下载所有高清图片，提取标题和完整描述文字。
  - **视频笔记**：下载无水印视频（如技术可行），提取标题和描述。
  - **用户信息**：提取发布者昵称（可选，用于备注来源）。
- **反爬处理**：
  - 处理验证码或登录限制（若抓取需要登录，需提供登录入口或 Cookie 注入）。
  - 模拟真实浏览器请求头 (User-Agent)。

### 3.2 本地资源管理
- **临时存储**：将下载的图片/视频临时保存在本地缓存目录。
- **资源清理**：发布完成或软件关闭后，自动清理临时文件，避免占用磁盘空间。

### 3.3 抖音自动发布
- **账号登录**：
  - 提供抖音二维码登录界面。
  - 保存登录状态（Cookie/Local Storage），避免每次发布都需要扫码。
  - 检测登录态失效并提示重新登录。
- **内容填充**：
  - 自动上传下载的图片或视频文件。
  - 自动填写标题（支持截取或添加前后缀）。
  - 自动填写描述文案（支持话题标签处理）。
  - 设置封面（可选，默认使用第一张图或视频帧）。
  - 设置发布位置、观看权限等（可选，默认公开）。
- **发布动作**：
  - 模拟点击“发布”按钮，或由用户手动点击确认。

### 3.4 用户界面 (UI)
- **主页**：包含链接输入框、解析按钮、历史记录列表（可选）。
- **预览页**：显示解析后的图片轮播/视频播放器、标题输入框、文案多行文本框。
- **设置页**：抖音账号管理（登录/登出）、默认话题设置、下载路径设置。

## 4. 技术架构

### 4.1 技术栈
- **Frontend**: Vue 3 + TypeScript + TailwindCSS (构建用户界面)
- **Backend**: Tauri 2.0 (Rust) (负责系统交互、文件系统操作)
- **Automation**: Tauri Webview + JS Injection
  - *核心方案*：利用 Tauri 的多窗口能力，创建一个隐藏或可见的 Webview 窗口加载目标网站（抖音/小红书）。
  - *交互方式*：通过 `eval` 或注入 JavaScript 脚本来操作 DOM（填写表单、点击按钮），并利用 Tauri 的 IPC 通信将状态回传给主控界面。相比 Playwright，此方案打包体积更小，且无需依赖额外的 Node.js 运行时环境。

### 4.2 数据流
1. **抓取阶段**：
   - 用户输入链接 -> Vue 主界面 -> Rust 创建新 Webview (加载小红书链接) -> 注入抓取脚本 -> 提取 DOM 数据 (图片/文案) -> 通过 IPC 发送回 Rust/主界面 -> 关闭抓取窗口。
2. **发布阶段**：
   - 用户点击发布 -> Rust 创建/激活 Webview (加载抖音创作者中心) -> 注入发布脚本 -> 模拟用户操作 (上传文件、填入文案) -> 监控发布状态。

## 5. 开发计划

### Phase 1: 原型验证 (MVP)
- [ ] 实现 Rust 端控制 Webview 窗口（创建、隐藏、通信）。
- [ ] 编写小红书抓取注入脚本 (JS)，提取 DOM 中的图片和文本。
- [ ] 实现图片下载到本地临时目录 (Rust)。
- [ ] 编写抖音发布注入脚本 (JS)，实现文件上传输入框的赋值与文本填写。
- [ ] 界面打通：输入链接 -> 触发抓取窗口 -> 预览 -> 触发发布窗口。

### Phase 2: 功能完善
- [ ] 优化 Webview 的 Cookie 管理，实现抖音/小红书的持久化登录。
- [ ] 增加对 Webview 页面加载状态的精确监听 (避免注入脚本过早执行)。
- [ ] 处理文件上传对话框 (Rust 端需配合 `rfd` 或模拟键盘操作，因为 Webview 文件上传通常会弹出系统原生框，需特殊处理或使用 fetch/xhr 模拟上传)。

### Phase 3: 体验优化
- [ ] 增加发布进度条与日志显示。
- [ ] 支持批量任务队列。
- [ ] 软件自动更新机制。

## 6. 注意事项
- **合规性**：确保抓取和发布行为符合平台用户协议，避免侵权。仅限用户搬运自己的内容或经授权的内容。
- **平台风控**：抖音和小红书均有严格的风控机制，自动化操作需控制频率，模拟人工行为（随机延迟、鼠标轨迹等）。
